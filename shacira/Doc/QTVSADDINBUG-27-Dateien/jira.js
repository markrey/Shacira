(function($,udf){var ns=".inputEvent ",dataBnd="bound.inputEvent",dataVal="value.inputEvent",dataDlg="delegated.inputEvent",bindTo=["input","textInput","propertychange","paste","cut","keydown","keyup","drop",""].join(ns),dlgtTo=["focusin","mouseover","dragstart",""].join(ns),supported={TEXTAREA:udf,INPUT:udf},delay={paste:udf,cut:udf,keydown:udf,drop:udf,textInput:udf};function isSupported(elem){return $(elem).attr("contenteditable")=="true"||elem.tagName in supported}$.event.special.txtinput={setup:function(data,namespaces,handler){var timer,bndCount,elem=this,$elem=$(this),triggered=false;if(isSupported(elem)){bndCount=$.data(elem,dataBnd)||0;if(!bndCount){$elem.bind(bindTo,handler)}$.data(elem,dataBnd,++bndCount);$.data(elem,dataVal,elem.value)}else{$elem.bind(dlgtTo,function(e){var target=e.target;if(isSupported(target)&&!$.data(elem,dataDlg)){bndCount=$.data(target,dataBnd)||0;if(!bndCount){$(target).bind(bindTo,handler)}$.data(elem,dataDlg,true);$.data(target,dataBnd,++bndCount);$.data(target,dataVal,target.value)}})}function handler(e){var elem=e.target;window.clearTimeout(timer),timer=null;if(triggered){return }if(e.type in delay&&!timer){timer=window.setTimeout(function(){if(elem.value!==$.data(elem,dataVal)){$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value)}},0)}else{if(e.type=="propertychange"){if(e.originalEvent.propertyName=="value"){$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}else{$(elem).trigger("txtinput");$.data(elem,dataVal,elem.value);triggered=true;window.setTimeout(function(){triggered=false},0)}}}},teardown:function(){var elem=$(this);elem.unbind(dlgtTo);elem.find("input, textarea").andSelf().each(function(){bndCount=$.data(this,dataBnd,($.data(this,dataBnd)||1)-1);if(!bndCount){elem.unbind(bindTo)}})}};$.fn.input=function(handler){return handler?$(this).bind("txtinput",handler):this.trigger("txtinput")}})(jQuery);
